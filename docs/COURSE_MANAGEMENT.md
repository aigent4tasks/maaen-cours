# وثائق نظام إدارة المحتوى - منصة "مَعِين"

## نظرة عامة

نظام إدارة المحتوى التعليمي هو أحد الأنظمة الأساسية في منصة "مَعِين". يوفر هذا النظام إمكانية إنشاء وإدارة الدورات والدروس والتصنيفات بشكل كامل وفعال.

## الميزات الرئيسية

### 1. إدارة الدورات
- إنشاء دورات جديدة
- تعديل الدورات الموجودة
- حذف الدورات
- تغيير حالة الدورة (مسودة، منشورة، مؤرشفة)
- إدارة صور الدورات
- تحديد سعر الدورة

### 2. إدارة الدروس
- إنشاء دروس داخل الدورات
- أنواع مختلفة من الدروس (فيديو، نص، اختبار، مهمة)
- ترتيب الدروس
- تحديد الدروس المجانية
- نشر/إخفاء الدروس
- إدارة مدة الدروس

### 3. نظام التصنيفات
- إنشاء تصنيفات جديدة
- تعديل التصنيفات
- حذف التصنيفات
- ربط الدورات بالتصنيفات
- إدارة أيقونات وألوان التصنيفات

### 4. التسجيل في الدورات
- تسجيل المستخدمين في الدورات
- تتبع حالة التسجيل
- إلغاء التسجيل
- حساب تقدم المستخدمين

## الواجهات البرمجية (API Endpoints)

### 1. دورات (`/api/courses`)

#### GET /api/courses
جلب جميع الدورات مع البحث والتصفية

**المعلمات:**
- `page`: رقم الصفحة (افتراضي: 1)
- `limit`: عدد النتائج في الصفحة (افتراضي: 12)
- `category`: تصفية حسب التصنيف
- `level`: تصفية حسب المستوى
- `search`: البحث في العنوان والوصف

**مثال الطلب:**
```typescript
const response = await fetch('/api/courses?page=1&limit=10&category=programming&level=BEGINNER&search=javascript');
const data = await response.json();
```

**الاستجابة:**
```json
{
  "courses": [
    {
      "id": "course-id",
      "title": "عنوان الدورة",
      "description": "وصف الدورة",
      "price": 99.99,
      "level": "BEGINNER",
      "status": "PUBLISHED",
      "instructor": {
        "id": "instructor-id",
        "name": "اسم المدرب",
        "image": "رابط الصورة"
      },
      "category": {
        "id": "category-id",
        "name": "اسم التصنيف",
        "icon": "icon-name",
        "color": "color-hex"
      },
      "lessons": [
        {
          "id": "lesson-id",
          "title": "عنوان الدرس",
          "duration": 30,
          "order": 1
        }
      ],
      "averageRating": 4.5,
      "totalDuration": 180,
      "reviewCount": 25,
      "_count": {
        "enrollments": 150,
        "reviews": 25
      }
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 100,
    "pages": 10
  }
}
```

#### POST /api/courses
إنشاء دورة جديدة

**نص الطلب:**
```json
{
  "title": "عنوان الدورة",
  "description": "وصف الدورة",
  "thumbnail": "رابط الصورة",
  "price": 99.99,
  "level": "BEGINNER",
  "instructorId": "instructor-id",
  "categoryId": "category-id"
}
```

**الاستجابة:**
```json
{
  "message": "تم إنشاء الدورة بنجاح",
  "course": {
    "id": "new-course-id",
    "title": "عنوان الدورة",
    "description": "وصف الدورة",
    "price": 99.99,
    "level": "BEGINNER",
    "status": "DRAFT",
    "instructorId": "instructor-id",
    "categoryId": "category-id",
    "createdAt": "2024-06-18T10:00:00Z",
    "updatedAt": "2024-06-18T10:00:00Z"
  }
}
```

### 2. تفاصيل الدورة (`/api/courses/[id]`)

#### GET /api/courses/[id]
جلب تفاصيل دورة محددة

**الاستجابة:**
```json
{
  "course": {
    "id": "course-id",
    "title": "عنوان الدورة",
    "description": "وصف الدورة",
    "thumbnail": "رابط الصورة",
    "price": 99.99,
    "level": "BEGINNER",
    "status": "PUBLISHED",
    "language": "ar",
    "duration": 180,
    "instructor": {
      "id": "instructor-id",
      "name": "اسم المدرب",
      "image": "رابط الصورة"
    },
    "category": {
      "id": "category-id",
      "name": "اسم التصنيف",
      "icon": "icon-name",
      "color": "color-hex"
    },
    "lessons": [
      {
        "id": "lesson-id",
        "title": "عنوان الدرس",
        "content": "محتوى الدرس",
        "videoUrl": "رابط الفيديو",
        "duration": 30,
        "order": 1,
        "type": "VIDEO",
        "isPublished": true,
        "isFree": false
      }
    ],
    "reviews": [
      {
        "id": "review-id",
        "rating": 5,
        "comment": "تعليق التقييم",
        "user": {
          "id": "user-id",
          "name": "اسم المستخدم",
          "image": "رابط الصورة"
        },
        "createdAt": "2024-06-18T10:00:00Z"
      }
    ],
    "averageRating": 4.5,
    "totalDuration": 180,
    "reviewCount": 25,
    "_count": {
      "enrollments": 150,
      "reviews": 25
    }
  }
}
```

### 3. التصنيفات (`/api/categories`)

#### GET /api/categories
جلب جميع التصنيفات

**الاستجابة:**
```json
{
  "categories": [
    {
      "id": "category-id",
      "name": "اسم التصنيف",
      "description": "وصف التصنيف",
      "icon": "icon-name",
      "color": "#3B82F6",
      "createdAt": "2024-06-18T10:00:00Z",
      "updatedAt": "2024-06-18T10:00:00Z"
    }
  ]
}
```

#### POST /api/categories
إنشاء تصنيف جديد

**نص الطلب:**
```json
{
  "name": "اسم التصنيف",
  "description": "وصف التصنيف",
  "icon": "icon-name",
  "color": "#3B82F6"
}
```

### 4. التسجيلات (`/api/enrollments`)

#### POST /api/enrollments
تسجيل مستخدم في دورة

**نص الطلب:**
```json
{
  "courseId": "course-id"
}
```

**الاستجابة:**
```json
{
  "message": "تم الانضمام إلى الدورة بنجاح",
  "enrollment": {
    "id": "enrollment-id",
    "userId": "user-id",
    "courseId": "course-id",
    "status": "ACTIVE",
    "progress": 0,
    "enrolledAt": "2024-06-18T10:00:00Z",
    "course": {
      "id": "course-id",
      "title": "عنوان الدورة",
      "instructor": {
        "id": "instructor-id",
        "name": "اسم المدرب"
      }
    }
  }
}
```

#### GET /api/enrollments
جلب تسجيلات المستخدم الحالي

**المعلمات:**
- `page`: رقم الصفحة (افتراضي: 1)
- `limit`: عدد النتائج في الصفحة (افتراضي: 10)
- `status`: تصفية حسب الحالة

**الاستجابة:**
```json
{
  "enrollments": [
    {
      "id": "enrollment-id",
      "status": "ACTIVE",
      "progress": 65,
      "enrolledAt": "2024-06-18T10:00:00Z",
      "progressPercentage": 65,
      "completedLessons": 13,
      "totalLessons": 20,
      "course": {
        "id": "course-id",
        "title": "عنوان الدورة",
        "description": "وصف الدورة",
        "thumbnail": "رابط الصورة",
        "level": "BEGINNER",
        "instructor": {
          "id": "instructor-id",
          "name": "اسم المدرب",
          "image": "رابط الصورة"
        },
        "category": {
          "id": "category-id",
          "name": "اسم التصنيف",
          "icon": "icon-name",
          "color": "color-hex"
        },
        "lessons": [
          {
            "id": "lesson-id",
            "title": "عنوان الدرس",
            "duration": 30,
            "order": 1
          }
        ],
        "_count": {
          "lessons": 20
        }
      }
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 5,
    "pages": 1
  }
}
```

### 5. التحقق من التسجيل (`/api/enrollments/check`)

#### GET /api/enrollments/check?courseId={courseId}
التحقق من تسجيل المستخدم في دورة

**الاستجابة:**
```json
{
  "enrolled": true,
  "enrollment": {
    "id": "enrollment-id",
    "userId": "user-id",
    "courseId": "course-id",
    "status": "ACTIVE",
    "progress": 65,
    "enrolledAt": "2024-06-18T10:00:00Z"
  }
}
```

## الصفحات الأمامية

### 1. صفحة الدورات (`/courses`)
عرض جميع الدورات مع البحث والتصفية

**المكونات الرئيسية:**
- `CourseCard`: بطاقة عرض الدورة
- `SearchInput`: حقل البحث
- `FilterSelect`: قوائم التصفية
- `Pagination`: أرقام الصفحات

**الوظائف:**
- البحث في الدورات
- التصفية حسب التصنيف والمستوى
- التحميل التدريجي للمزيد من الدورات
- عرض معلومات الدورة الأساسية

### 2. صفحة تفاصيل الدورة (`/courses/[id]`)
عرض تفاصيل دورة محددة

**المكونات الرئيسية:**
- `CourseHeader`: معلومات الدورة الأساسية
- `EnrollmentCard`: بطاقة التسجيل في الدورة
- `CourseContent`: محتوى الدورة (دروس، تقييمات)
- `CourseStats`: إحصائيات الدورة

**الوظائف:**
- عرض معلومات الدورة الكاملة
- التسجيل في الدورة
- عرض الدروس والتقييمات
- التحقق من حالة التسجيل

### 3. لوحة تحكم المستخدم (`/dashboard`)
عرض الدورات المسجلة للمستخدم

**المكونات الرئيسية:**
- `DashboardHeader`: رأس لوحة التحكم
- `StatsCards`: بطاقات الإحصائيات
- `EnrolledCourses`: قائمة الدورات المسجلة
- `ProgressIndicator`: مؤشر التقدم

**الوظائف:**
- عرض إحصائيات المستخدم
- عرض الدورات المسجلة
- تتبع التقدم في الدورات
- الوصول إلى واجهة التعلم

### 4. واجهة التعلم (`/dashboard/courses/[id]`)
واجهة تعلم الدورة

**المكونات الرئيسية:**
- `CourseProgress`: شريط تقدم الدورة
- `LessonList`: قائمة الدروس
- `LessonPlayer`: مشغل الدروس
- `DiscussionSection`: قسم النقاشات

**الوظائف:**
- عرض تقدم الدورة
- تشغيل الدروس
- تحديد الدروس كمكتملة
- المشاركة في النقاشات

### 5. لوحة تحكم المشرف (`/admin`)
لوحة تحكم المشرف لإدارة المحتوى

**المكونات الرئيسية:**
- `AdminStats`: إحصائيات المشرف
- `QuickActions`: إجراءات سريعة
- `RecentActivity`: النشاط الحديث
- `CourseManagement`: إدارة الدورات

**الوظائف:**
- عرض إحصائيات المنصة
- إدارة الدورات
- عرض النشاط الحديث
- الوصول إلى صفحات الإدارة

## إدارة الدورات للمشرفين

### 1. صفحة إدارة الدورات (`/admin/courses`)
إدارة دورات المشرف

**الواجهات البرمجية:**
- `GET /api/admin/courses`: جلب دورات المشرف
- `POST /api/admin/courses`: إنشاء دورة جديدة
- `DELETE /api/admin/courses/[id]`: حذف دورة

**الميزات:**
- عرض جميع الدورات
- إنشاء دورة جديدة
- تعديل الدورات الموجودة
- حذف الدورات
- تغيير حالة الدورة

### 2. إنشاء دورة جديدة
**نموذج إنشاء الدورة:**
```typescript
interface CourseFormData {
  title: string;
  description: string;
  price: number;
  level: CourseLevel;
  status: CourseStatus;
  instructorId: string;
  categoryId?: string;
}
```

**خطوات الإنشاء:**
1. ملء نموذج الدورة
2. التحقق من صحة البيانات
3. إرسال الطلب إلى الـ API
4. عرض رسالة نجاح
5. إعادة توجيه إلى صفحة الدورة

### 3. تعديل الدورة
**خطوات التعديل:**
1. جلب بيانات الدورة الحالية
2. ملء النموذج بالبيانات الحالية
3. تعديل البيانات المطلوبة
4. إرسال الطلب للتحديث
5. عرض رسالة نجاح

### 4. حذف الدورة
**خطوات الحذف:**
1. طلب تأكيد من المستخدم
2. التحقق من وجود تسجيلات
3. حذف الدورة والبيانات المرتبطة
4. عرض رسالة نجاح
5. إعادة توجيه إلى قائمة الدورات

## أفضل المميزات

### 1. إدارة الدورات
- **إنشاء دورة:** نموذج شامل لإنشاء دورات جديدة
- **تعديل دورة:** تعديل جميع معلومات الدورة
- **حذف دورة:** حذف آمن مع التحقق من الاعتمادات
- **تغيير الحالة:** تغيير حالة الدورة (مسودة، منشورة، مؤرشفة)

### 2. إدارة الدروس
- **إنشاء درس:** إضافة دروس جديدة للدورات
- **ترتيب الدروس:** سحب وإفلات لترتيب الدروس
- **نشر الدرس:** نشر/إخفاء الدروس
- **الدروس المجانية:** تحديد الدروس المجانية

### 3. التصنيفات
- **إنشاء تصنيف:** إنشاء تصنيفات جديدة
- **تعديل تصنيف:** تعديل معلومات التصنيف
- **حذف تصنيف:** حذف التصنيفات غير المستخدمة
- **الأيقونات:** إدارة أيقونات التصنيفات

### 4. التسجيلات
- **تتبع التسجيل:** تتبع تسجيلات المستخدمين
- **حالة التسجيل:** تغيير حالة التسجيل
- **إحصائيات التسجيل:** عرض إحصائيات التسجيلات

## الأمان والصلاحيات

### 1. الصلاحيات المطلوبة
- **عرض الدورات:** لا يتطلب مصادقة
- **إنشاء دورة:** دور INSTRUCTOR أو ADMIN
- **تعديل دورة:** صاحب الدورة أو ADMIN
- **حذف دورة:** صاحب الدورة أو ADMIN
- **عرض دورات المشرف:** دور ADMIN فقط

### 2. التحقق من الصلاحيات
```typescript
// التحقق من دور المستخدم
if (session.user.role !== 'INSTRUCTOR' && session.user.role !== 'ADMIN') {
  return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
}

// التحقق من ملكية الدورة
const course = await db.course.findUnique({
  where: { id: courseId },
  select: { instructorId: true }
});

if (course.instructorId !== session.user.id && session.user.role !== 'ADMIN') {
  return NextResponse.json({ error: 'Forbidden' }, { status: 403 });
}
```

### 3. حماية البيانات
- التحقق من صحة المدخلات
- استخدام Prepared Statements
- عدم تعرض البيانات الحساسة
- تسجيل الأنشطة

## الأداء والتحسين

### 1. تحسين الاستعلامات
- استخدام `select` لاختيار الحقول المطلوبة فقط
- استخدام `include` للعلاقات المطلوبة فقط
- استخدام الفهارس للبحث والترتيب
- استخدام الترحيم للبيانات الكبيرة

### 2. التخزين المؤقت
- تخزين بيانات الدورات الشائعة
- تخزين إحصائيات الدورات
- تخزين قوائم التصنيفات
- تحديث التخزين المؤقت عند التغيير

### 3. تحسين الصور
- ضغط الصور تلقائياً
- استخدام أحجام مختلفة للصور
- التحميل البطيء للصور
- استخدام الصور النائبة (placeholder)

## استكشاف الأخطاء

### 1. مشاكل شائعة
- **الدورة لا تظهر:** تحقق من حالة الدورة (يجب تكون PUBLISHED)
- **لا يمكن إنشاء دورة:** تحقق من صلاحيات المستخدم
- **الصور لا تعرض:** تحقق من روابط الصور
- **التسجيل لا يعمل:** تحقق من وجود المستخدم والدورة

### 2. رسائل خطأ مقترحة
```typescript
// دورة غير موجودة
if (!course) {
  return NextResponse.json({ error: 'الدورة غير موجودة' }, { status: 404 });
}

// غير مصرح بالوصول
if (session.user.role !== 'INSTRUCTOR' && session.user.role !== 'ADMIN') {
  return NextResponse.json({ error: 'غير مصرح بإنشاء الدورات' }, { status: 403 });
}

// بيانات غير صالحة
if (!title || title.length < 3) {
  return NextResponse.json({ error: 'عنوان الدورة مطلوب' }, { status: 400 });
}
```

### 3. تسجيل الأخطاء
```typescript
// تسجيل أخطاء إنشاء الدورات
console.error('Course creation error:', error);

// تسجيل أخطاء التسجيل
console.error('Enrollment error:', error);

// تسجيل أخطاء عامة
console.error('API error:', error);
```

## التطوير المستقبلي

### 1. ميزات مقترحة
- **نظام النسخ الاحتياطي:** نسخ احتياطي للدورات
- **استيراد/تصدير:** استيراد وتصدير الدورات
- **النسخ المتماثل:** نسخ الدورات
- **القوالب:** قوالب جاهزة للدورات
- **التعاون:** تعاون多个 المدربين في دورة واحدة

### 2. تحسينات مقترحة
- **تحسين البحث:** بحث متقدم مع اقتراحات
- **تحسين الترتيب:** ترتيب ذكي للدورات
- **تحسين الأداء:** تحسين أداء تحميل الدورات
- **تحسين الواجهة:** تحسين واجهة إدارة الدورات

### 3. تكاملات مقترحة
- **تخزين السحابة:** تكامل مع خدمات التخزين السحابي
- **معالجة الفيديو:** تكامل مع خدمات معالجة الفيديو
- **الدفع:** تكامل مع بوابات الدفع
- **الإشعارات:** تكامل مع نظام الإشعارات

---

## الخاتمة

نظام إدارة المحتوى التعليمي في منصة "مَعِين" يوفر حلاً متكاملاً وفعالاً لإدارة الدورات والدروس. تم تصميم النظام ليكون سهل الاستخدام وقابلاً للتوسع مع الحفاظ على الأمان والأداء.

**ملاحظة:** عند إضافة ميزات جديدة، تأكد من اتباع الأنماط الحالية والحفاظ على تناسق الواجهة والأداء.